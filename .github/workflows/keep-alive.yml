name: Keep Supabase Active (Simple & Reliable)

on:
  schedule:
    # Run every 2 days at 3:00 AM UTC to prevent 7-day auto-pause
    - cron: '0 3 */2 * *'

  # Allow manual trigger from GitHub Actions UI
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
    - name: Ping Production App to Keep Supabase Active
      run: |
        echo "ğŸ“ Simple Supabase keep-alive starting..."
        echo "ğŸ“… Run time: $(date -u)"
        echo "ğŸ”„ Frequency: Every 2 days"
        echo "ğŸ¯ Purpose: Prevent 7-day Supabase auto-pause on free tier"
        echo "ğŸ“ Method: Ping production app which connects to Supabase"
        echo ""

        # Ping the production application
        echo "ğŸŒ Pinging production application..."
        app_response=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 \
          "https://stronger.tinymanager.ai")

        echo "Production app response: $app_response"

        if [ "$app_response" -eq 200 ]; then
          echo "âœ… SUCCESS: Production application is healthy"
          echo "âœ… SUCCESS: App activity will keep Supabase database active"
          echo "ğŸ›¡ï¸ Supabase project will remain active"
        else
          echo "âš ï¸ WARNING: Unexpected response code: $app_response"
          echo "ğŸ“ Manual check may be needed"
        fi

        echo ""
        echo "ğŸ“Š Summary:"
        echo "   â€¢ Production app ping: $app_response"
        echo "   â€¢ Supabase backend activity: Generated through app"
        echo "   â€¢ Auto-pause prevention: âœ… Active"

    - name: Summary Report
      run: |
        echo ""
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ¯ SIMPLE KEEP-ALIVE COMPLETE"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ“… Completed: $(date -u)"
        echo "â° Next run: In 2 days"
        echo "ğŸ”„ Schedule: Every 2 days at 3:00 AM UTC"
        echo "ğŸ›¡ï¸ Protection: Against 7-day Supabase auto-pause"
        echo "ğŸ“ Method: Production app ping (simple & reliable)"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"